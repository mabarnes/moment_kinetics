<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>machine_setup notes · moment_kinetics</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">moment_kinetics</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../constraints_on_normalized_distribution_function/">Constraints on normalized distribution function</a></li><li><a class="tocitem" href="../debugging-hints/">Debugging</a></li><li><a class="tocitem" href="../developing/">Developing</a></li><li><a class="tocitem" href="../external_sources_notes/">External sources</a></li><li><a class="tocitem" href="../geometry/">Magnetic Geometry</a></li><li><a class="tocitem" href="../getting_started/">Getting started</a></li><li><a class="tocitem" href="../input_options/">Input Options</a></li><li class="is-active"><a class="tocitem" href><code>machine_setup</code> notes</a><ul class="internal"><li><a class="tocitem" href="#Notes-on-some-prompts-from-the-script"><span>Notes on some prompts from the script</span></a></li><li><a class="tocitem" href="#Defaults-for-prompts"><span>Defaults for prompts</span></a></li><li><a class="tocitem" href="#bin/julia"><span><code>bin/julia</code></span></a></li><li><a class="tocitem" href="#julia.env"><span><code>julia.env</code></span></a></li><li><a class="tocitem" href="#Setup-of-post-processing-packages"><span>Setup of post processing packages</span></a></li><li><a class="tocitem" href="#Use-of-system-images"><span>Use of system images</span></a></li><li><a class="tocitem" href="#Operations-done-by-machines/machine_setup.sh"><span>Operations done by <code>machines/machine_setup.sh</code></span></a></li><li><a class="tocitem" href="#machine_setup_api_documentation"><span>API documentation</span></a></li></ul></li><li><a class="tocitem" href="../manual_setup/">Manual setup</a></li><li><a class="tocitem" href="../moment_kinetic_equations/">Moment kinetic equations</a></li><li><a class="tocitem" href="../parameter_scans/">Parameter scans</a></li><li><a class="tocitem" href="../post_processing_notes/">Post processing</a></li><li><a class="tocitem" href="../shared_memory_debugging/">Shared memory debugging</a></li><li><a class="tocitem" href="../wall_boundary_conditions/">Wall boundary conditions with moment constraints</a></li><li><a class="tocitem" href="../zz_advection/"><code>advection</code></a></li><li><a class="tocitem" href="../zz_analysis/"><code>analysis</code></a></li><li><a class="tocitem" href="../zz_array_allocation/"><code>array_allocation</code></a></li><li><a class="tocitem" href="../zz_bgk/"><code>bgk</code></a></li><li><a class="tocitem" href="../zz_calculus/"><code>calculus</code></a></li><li><a class="tocitem" href="../zz_charge_exchange/"><code>charge_exchange</code></a></li><li><a class="tocitem" href="../zz_chebyshev/"><code>chebyshev</code></a></li><li><a class="tocitem" href="../zz_clenshaw_curtis/"><code>clenshaw_curtis</code></a></li><li><a class="tocitem" href="../zz_command_line_options/"><code>command_line_options</code></a></li><li><a class="tocitem" href="../zz_communication/"><code>communication</code></a></li><li><a class="tocitem" href="../zz_constants/"><code>constants</code></a></li><li><a class="tocitem" href="../zz_continuity/"><code>continuity</code></a></li><li><a class="tocitem" href="../zz_coordinates/"><code>coordinates</code></a></li><li><a class="tocitem" href="../zz_debugging/"><code>debugging</code></a></li><li><a class="tocitem" href="../zz_derivatives/"><code>derivatives</code></a></li><li><a class="tocitem" href="../zz_em_fields/"><code>em_fields</code></a></li><li><a class="tocitem" href="../zz_energy_equation/"><code>energy_equation</code></a></li><li><a class="tocitem" href="../zz_external_sources/"><code>external_sources</code></a></li><li><a class="tocitem" href="../zz_file_io/"><code>file_io</code></a></li><li><a class="tocitem" href="../zz_finite_differences/"><code>finite_differences</code></a></li><li><a class="tocitem" href="../zz_fokker_planck/"><code>fokker_planck</code></a></li><li><a class="tocitem" href="../zz_fokker_planck_calculus/"><code>fokker_planck_calculus</code></a></li><li><a class="tocitem" href="../zz_fokker_planck_test/"><code>fokker_planck_test</code></a></li><li><a class="tocitem" href="../zz_force_balance/"><code>force_balance</code></a></li><li><a class="tocitem" href="../zz_gauss_legendre/"><code>gauss_legendre</code></a></li><li><a class="tocitem" href="../zz_geo/"><code>geo</code></a></li><li><a class="tocitem" href="../zz_initial_conditions/"><code>initial_conditions</code></a></li><li><a class="tocitem" href="../zz_input_structs/"><code>input_structs</code></a></li><li><a class="tocitem" href="../zz_interpolation/"><code>interpolation</code></a></li><li><a class="tocitem" href="../zz_ionization/"><code>ionization</code></a></li><li><a class="tocitem" href="../zz_krook_collisions/"><code>krook_collisions</code></a></li><li><a class="tocitem" href="../zz_load_data/"><code>load_data</code></a></li><li><a class="tocitem" href="../zz_looping/"><code>looping</code></a></li><li><a class="tocitem" href="../zz_makie_post_processing/"><code>makie_post_processing</code></a></li><li><a class="tocitem" href="../zz_manufactured_solns/"><code>manufactured_solns</code></a></li><li><a class="tocitem" href="../zz_moment_constraints/"><code>moment_constraints</code></a></li><li><a class="tocitem" href="../zz_moment_kinetics/"><code>moment_kinetics</code></a></li><li><a class="tocitem" href="../zz_moment_kinetics_input/"><code>moment_kinetics_input</code></a></li><li><a class="tocitem" href="../zz_moment_kinetics_structs/"><code>moment_kinetics_structs</code></a></li><li><a class="tocitem" href="../zz_neutral_r_advection/"><code>neutral_r_advection</code></a></li><li><a class="tocitem" href="../zz_neutral_vz_advection/"><code>neutral_vz_advection</code></a></li><li><a class="tocitem" href="../zz_neutral_z_advection/"><code>neutral_z_advection</code></a></li><li><a class="tocitem" href="../zz_numerical_dissipation/"><code>numerical_dissipation</code></a></li><li><a class="tocitem" href="../zz_plot_MMS_sequence/"><code>plot_MMS_sequence</code></a></li><li><a class="tocitem" href="../zz_plot_sequence/"><code>plot_sequence</code></a></li><li><a class="tocitem" href="../zz_plots_post_processing/"><code>plots_post_processing</code></a></li><li><a class="tocitem" href="../zz_quadrature/"><code>quadrature</code></a></li><li><a class="tocitem" href="../zz_r_advection/"><code>r_advection</code></a></li><li><a class="tocitem" href="../zz_reference_parameters/"><code>reference_parameters</code></a></li><li><a class="tocitem" href="../zz_source_terms/"><code>source_terms</code></a></li><li><a class="tocitem" href="../zz_time_advance/"><code>time_advance</code></a></li><li><a class="tocitem" href="../zz_type_definitions/"><code>type_definitions</code></a></li><li><a class="tocitem" href="../zz_utils/"><code>utils</code></a></li><li><a class="tocitem" href="../zz_velocity_grid_transforms/"><code>velocity_grid_transforms</code></a></li><li><a class="tocitem" href="../zz_velocity_moments/"><code>velocity_moments</code></a></li><li><a class="tocitem" href="../zz_vpa_advection/"><code>vpa_advection</code></a></li><li><a class="tocitem" href="../zz_z_advection/"><code>z_advection</code></a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href><code>machine_setup</code> notes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href><code>machine_setup</code> notes</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mabarnes/moment_kinetics/blob/master/machines/README.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="machine_setup-notes"><a class="docs-heading-anchor" href="#machine_setup-notes"><code>machine_setup</code> notes</a><a id="machine_setup-notes-1"></a><a class="docs-heading-anchor-permalink" href="#machine_setup-notes" title="Permalink"></a></h1><p>The <code>machines</code> subdirectory provides scripts to set up Julia and <code>moment_kinetics</code> to run on laptops/desktops or on clusters. If the cluster is not one of the currently supported machines, then some additional manual setup is required.</p><p>Currently supported:</p><ul><li>&quot;generic-pc&quot; - A generic personal computer (i.e. laptop or desktop machine). Set up for interactive use, rather than for submitting jobs to a batch queue.</li><li>&quot;generic-batch&quot; - A generic cluster using a batch queue. Requires some manual setup first, see <code>machines/generic-batch-template/README.md</code>.</li><li>&quot;archer&quot; - the UK supercomputer <a href="https://www.archer2.ac.uk/">ARCHER2</a></li><li>&quot;marconi&quot; - the EUROfusion supercomputer <a href="https://wiki.u-gov.it/confluence/display/SCAIUS/UG3.1%3A+MARCONI+UserGuide">Marconi</a></li></ul><p>The usage is described in <a href="../getting_started/#Getting-started">Getting started</a>. This page contains some extra technical information.</p><h2 id="Notes-on-some-prompts-from-the-script"><a class="docs-heading-anchor" href="#Notes-on-some-prompts-from-the-script">Notes on some prompts from the script</a><a id="Notes-on-some-prompts-from-the-script-1"></a><a class="docs-heading-anchor-permalink" href="#Notes-on-some-prompts-from-the-script" title="Permalink"></a></h2><p>You will be prompted to enter a location for your <code>.julia</code> directory. If you are installing on a personal computer or on a cluster which allows access to your home directory from compute nodes, it is fine to leave this as the default. If not (e.g. on ARCHER2), you need to set a path which is accessible from the compute nodes.  If you want to create a completely self-contained install (e.g. for reproducibility or for debugging some dependency conflicts), you might want to put <code>.julia</code> within the <code>moment_kinetics</code> directory (i.e. enter <code>.julia</code> at the prompt).</p><h2 id="Defaults-for-prompts"><a class="docs-heading-anchor" href="#Defaults-for-prompts">Defaults for prompts</a><a id="Defaults-for-prompts-1"></a><a class="docs-heading-anchor-permalink" href="#Defaults-for-prompts" title="Permalink"></a></h2><p>The default value for each of the settings that the user is prompted for interactively are first taken from some sensible, machine-specific defaults. When <code>machines/machine_setup.sh</code> is run, the values chosen by the user are saved in the <code>[moment_kinetics]</code> section of <code>LocalPreferences.toml</code>, and these values are used as the defaults next time <code>machines/machine_setup.sh</code> is run, in order to make it easier to re-run the setup, e.g. because some dependencies need updating, or to change just one or a few settings.</p><p>A few settings (which are needed before Julia can be started for the first time) are saved into hidden files (<code>.julia_default.txt</code>, <code>.this_machine_name.txt</code>, and <code>.julia_directory_default.txt</code>) instead of into <code>LocalPreferences.toml</code>, to avoid needing to parse a TOML file using <code>bash</code>.</p><h2 id="bin/julia"><a class="docs-heading-anchor" href="#bin/julia"><code>bin/julia</code></a><a id="bin/julia-1"></a><a class="docs-heading-anchor-permalink" href="#bin/julia" title="Permalink"></a></h2><p>A symlink or script is created at <code>bin/julia</code> to call the chosen julia executable. On HPC systems we create a file <code>julia.env</code> which must be <code>source</code>&#39;d (to load the right modules, etc.) before <code>julia</code> can be used - in this case <code>julia.env</code> can be used to set up any environment variables, etc. so a symlink is sufficient. On laptops/desktops that will be used interactively, it is inconvenient to have to remember to <code>source julia.env</code>, especially if you have multiple instances of <code>moment_kinetics</code>, so instead the necessary setup (of the <code>JULIA_DEPOT_PATH</code> environment variable, if needed, and a Python venv if the Plots-based post processing is enabled) is done by making <code>bin/julia</code> a   small bash script, which does that setup and then calls the chosen <code>julia</code>   executable, passing through to it any command line arguments.</p><h2 id="julia.env"><a class="docs-heading-anchor" href="#julia.env"><code>julia.env</code></a><a id="julia.env-1"></a><a class="docs-heading-anchor-permalink" href="#julia.env" title="Permalink"></a></h2><p>A <code>julia.env</code> file is used on HPC systems to set up the environment (modules and environment variables). On laptop/desktop systems this would be inconvenient (especially if there are multiple instances of <code>moment_kinetics</code>) so a <code>julia.env</code> is not used for these.</p><p>The <code>julia.env</code> is created from a template <code>julia.env</code> which is located in the subdirectory of <code>machines/</code> for the specific machine being set up.</p><p>If you need to run <code>julia</code> interactively (for <code>moment_kinetics</code>) on a machine that uses <code>julia.env</code>, either run <code>source julia.env</code> in each terminal session where you want to use <code>moment_kinetics</code>, or add it to your <code>.bashrc</code> (if this does not conflict with any other projects).</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Note that <code>julia.env</code> runs <code>module purge</code> to remove any already loaded modules (to get a clean environment). It is therefore very likely to interfere with other projects.</p></div></div><h2 id="Setup-of-post-processing-packages"><a class="docs-heading-anchor" href="#Setup-of-post-processing-packages">Setup of post processing packages</a><a id="Setup-of-post-processing-packages-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-of-post-processing-packages" title="Permalink"></a></h2><p>See <a href="../developing/#Post-processing-packages">Post processing packages</a>.</p><h2 id="Use-of-system-images"><a class="docs-heading-anchor" href="#Use-of-system-images">Use of system images</a><a id="Use-of-system-images-1"></a><a class="docs-heading-anchor-permalink" href="#Use-of-system-images" title="Permalink"></a></h2><p>On HPC clusters, creating system images <code>moment_kinetics.so</code> and for post processing <code>makie_postproc.so</code> and/or <code>plots_postproc.so</code> is required. This is to avoid (as far as practical) wasting CPU hours doing identical compilation in large parallel jobs. If you wanted to remove this requirement for some reason (although this is not recommended), you would need to go to the subdirectory of <code>machines/</code> for the machine you are working on, and edit the <code>jobscript-run.template</code>, <code>jobscript-restart.template</code>, <code>jobscript-postprocess.template</code>, and <code>jobscript-postprocess-plotsjl.template</code> files to remove the <code>-J*.so</code> argument.  If you do do this, please do not commit those changes and merge them to the <code>master</code> branch of <code>moment_kinetics</code>.</p><h2 id="Operations-done-by-machines/machine_setup.sh"><a class="docs-heading-anchor" href="#Operations-done-by-machines/machine_setup.sh">Operations done by <code>machines/machine_setup.sh</code></a><a id="Operations-done-by-machines/machine_setup.sh-1"></a><a class="docs-heading-anchor-permalink" href="#Operations-done-by-machines/machine_setup.sh" title="Permalink"></a></h2><p>The convenience script <code>machine_setup.sh</code> is provide because the actual setup happens in multiple stages, with Julia being restarted in between (as this is required on some machines), and because the script is able to download Julia if Julia is not already installed.</p><p>The steps done by <code>machines/machine_setp.sh</code> are:</p><ol><li><p>Get the name of the &#39;machine&#39; (&#39;generic-pc&#39;, &#39;archer&#39;, etc.) so that machine-dependent setup can be done and machine-specific defaults can be used. ()</p></li><li><p>Download a Julia executable, or prompt the user for the location of one (defaulting to any <code>julia</code> found in <code>$PATH</code>).</p></li><li><p>Get the location of the <code>.julia</code> directory to be used by (this copy of) <code>moment_kinetics</code>. At this point we have enough setup to start using <code>julia</code>. Export <code>JULIA_DEPOT_PATH</code> so that this is used any time <code>julia</code> is run in the rest of the script.</p></li><li><p>Run <code>machines/shared/machine_setup.jl</code>. This script (whose functions are documented in <a href="#machine_setup_api_documentation">API documentation</a>):</p><ul><li>prompts the user for most of the settings (and saves them to <code>LocalPreferences.toml</code> from where they can be accessed by other scripts later and used as defaults if <code>machines/machine_setup</code> is re-run)</li><li>creates the <code>julia.env</code> file (from the template for the given machine) on HPC systems</li><li>creates the <code>bin/julia</code> symlink or script (see <a href="#bin/julia">bin/julia</a>)</li><li>creates a link to the <code>compile_dependencies.sh</code> script for the machine (if there is one).</li><li>installs the <code>Revise</code> package and adds <code>using Revise</code> to the <code>startup.jl</code> file (on laptop/desktop systems, and if the user did not de-select this).</li></ul><p>It is necessary to restart <code>julia</code> after this script has been run, so that we can first <code>source julia.env</code> (if it exists) or use the script at <code>bin/julia</code> in order to use the environment settings in them.</p></li><li><p>If <code>julia.env</code> exists, run <code>source julia.env</code> to load modules, etc.</p></li><li><p>Set the optimization flags that will be used for running simulations or for running post processing. These need to be set the same as will be used eventually so that precompilation of dependencies and packages that happens while running <code>machines/machine_setup.sh</code> does not need to be overwritten (due to different optimization flags) later, as this would be a waste of time (although it should work fine).</p></li><li><p>Add various dependencies to the top-level project, by calling <code>machines/shared/add_dependencies_to_project.jl</code>. This will set up MPI and HDF5 to link to the correct libraries. <code>julia</code> needs to be restarted after the setup of MPI and HDF5 is done, which is why this is a separate script from the following one (this separation also allows <code>add_dependencies_to_project.jl</code> to be re-used in <code>makie_post_processing_setup.jl</code> and <code>plots_post_processing_setup.jl</code> if these are to be set up as separate projects from the top-level one).</p></li><li><p>Complete the setup by running <code>machines/shared/machine_setup_stage_two.jl</code>, which creates a Python venv with matplotlib installed (if <code>plots_post_processing</code> is enabled), creates symlinks at the top level to scripts to submit batch jobs (if setting up for an HPC cluster), and submits a job to compile a system image for <code>moment_kinetics</code> (if setting up for an HPC cluster, and if the user did not de-select this).</p></li><li><p>Set up <code>makie_post_processing</code> (if enabled) by running <code>machines/shared/makie_post_processing_setup.jl</code> and/or <code>plots_post_processing (if enabled)</code> by running <code>machines/shared/plots_post_processing_setup.jl</code>. These scripts also submit jobs to create system images for <code>makie_post_processing</code> or <code>plots_post_processing</code> (if setting up for an HPC cluster, and if the user did not de-select this).</p></li><li><p>Print a message indicating which optimization flags to use for running simulations or for post-processing.</p></li></ol><h2 id="machine_setup_api_documentation"><a class="docs-heading-anchor" href="#machine_setup_api_documentation">API documentation</a><a id="machine_setup_api_documentation-1"></a><a class="docs-heading-anchor-permalink" href="#machine_setup_api_documentation" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="moment_kinetics.machine_setup" href="#moment_kinetics.machine_setup"><code>moment_kinetics.machine_setup</code></a> — <span class="docstring-category">Module</span></header><section><div><p>Functions to help setting up on known machines</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mabarnes/moment_kinetics/blob/13268a0a7891ad133a09567ad4308dbb856f0984/machines/shared/machine_setup.jl#L1-L3">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="moment_kinetics.machine_setup.get_setting" href="#moment_kinetics.machine_setup.get_setting"><code>moment_kinetics.machine_setup.get_setting</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_setting(setting_name, message, machine, local_defaults,
            possible_values=nothing)</code></pre><p>Prompt the user to set a setting called <code>setting_name</code> after printing <code>message</code>. Default value is read from <code>local_defaults</code> if it exists there (which it will do if it has been set before, as then it is stored in <code>LocalPreferences.toml</code>), or from sensible defaults in the <code>machine</code> section of <code>default_settings</code> otherwise.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mabarnes/moment_kinetics/blob/13268a0a7891ad133a09567ad4308dbb856f0984/machines/shared/machine_setup.jl#L77-L85">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="moment_kinetics.machine_setup.get_user_input-Tuple{Any, Any}" href="#moment_kinetics.machine_setup.get_user_input-Tuple{Any, Any}"><code>moment_kinetics.machine_setup.get_user_input</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">get_user_input(possible_values, default_value)</code></pre><p>Prompt for user input. If the user enters nothing, return <code>default_value</code>. Check that the entered value is one of <code>possible_values</code>, if not prompt again.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mabarnes/moment_kinetics/blob/13268a0a7891ad133a09567ad4308dbb856f0984/machines/shared/machine_setup.jl#L43-L48">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="moment_kinetics.machine_setup.machine_setup_moment_kinetics-Tuple{String}" href="#moment_kinetics.machine_setup.machine_setup_moment_kinetics-Tuple{String}"><code>moment_kinetics.machine_setup.machine_setup_moment_kinetics</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">machine_setup_moment_kinetics(machine::String; ; no_force_exit::Bool=false,
                              interactive::Bool=true)</code></pre><p>Do setup for a known <code>machine</code>, prompting the user for various settings (with defaults set to sensible values - if the script has been run before, the defaults are the previously used values):</p><ul><li><p>On clusters that use a module system, provide <code>julia.env</code> at the top level of the moment_kinetics repo.</p><p>Call</p><pre><code class="language-shell hljs">source julia.env</code></pre><p>to get the correct modules for running moment_kinetics, either on the command line (to get them for the current session) or in your <code>.bashrc</code> (to get them by default). Note that this calls <code>module purge</code> so will remove any currently loaded modules when it is run.</p></li><li><p>Makes a symlink to, or a bash script that calls, the Julia executable used to run this command at <code>bin/julia</code> under the moment_kinetics repo, so that setup and job submission scripts can use a known relative path.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If you change the Julia executable, e.g. to update to a new verison, you will need to either replace the symlink <code>&lt;moment_kinetics&gt;/bin/julia</code> or edit the bash script at <code>&lt;moment_kinetics&gt;/bin/julia</code> by hand, or re-run this function using the new executable.</p></div></div></li></ul><p>Usually it is necessary for Julia to be restarted after running this function to run Julia with the correct <code>JULIA_DEPOT_PATH</code>, etc. so the function will force Julia to exit. If for some reason this is not desired (e.g. when debugging), pass <code>no_force_exit=true</code>.</p><p>The <code>interactive</code> argument exists so that when this function is called from another script, terminal output with instructions for the next step can be disabled.</p><p>Currently supported machines:</p><ul><li><code>&quot;generic-pc&quot;</code> - A generic personal computer (i.e. laptop or desktop machine).. Set up   for interactive use, rather than for submitting jobs to a batch queue.</li><li><code>&quot;generic-batch&quot;</code> - A generic cluster using a batch queue. Requires some manual setup   first, see <code>machines/generic-batch-template/README.md</code>.</li><li><code>&quot;archer&quot;</code> - the UK supercomputer <a href="https://www.archer2.ac.uk/">ARCHER2</a></li><li><code>&quot;marconi&quot;</code> - the EUROfusion supercomputer   <a href="https://wiki.u-gov.it/confluence/display/SCAIUS/UG3.1%3A+MARCONI+UserGuide">Marconi</a></li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The settings created by this function are saved in LocalPreferences.toml. It might sometimes be useful to edit these by hand (e.g.  the <code>account</code> setting if this needs to be changed.): it is fine to do this.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mabarnes/moment_kinetics/blob/13268a0a7891ad133a09567ad4308dbb856f0984/machines/shared/machine_setup.jl#L109-L156">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../input_options/">« Input Options</a><a class="docs-footer-nextpage" href="../manual_setup/">Manual setup »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 28 March 2024 11:00">Thursday 28 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
