<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual setup · moment_kinetics</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">moment_kinetics</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../constraints_on_normalized_distribution_function/">Constraints on normalized distribution function</a></li><li><a class="tocitem" href="../debugging-hints/">Debugging</a></li><li><a class="tocitem" href="../developing/">Developing</a></li><li><a class="tocitem" href="../external_sources_notes/">External sources</a></li><li><a class="tocitem" href="../geometry/">Magnetic Geometry</a></li><li><a class="tocitem" href="../getting_started/">Getting started</a></li><li><a class="tocitem" href="../input_options/">Input Options</a></li><li><a class="tocitem" href="../machine_setup_notes/"><code>machine_setup</code> notes</a></li><li class="is-active"><a class="tocitem" href>Manual setup</a><ul class="internal"><li><a class="tocitem" href="#Install-Julia"><span>Install Julia</span></a></li><li><a class="tocitem" href="#Add-moment_kinetics-packages"><span>Add <code>moment_kinetics</code> packages</span></a></li><li><a class="tocitem" href="#Set-up-MPI"><span>Set up MPI</span></a></li><li><a class="tocitem" href="#Link-HDF5"><span>Link HDF5</span></a></li><li><a class="tocitem" href="#Enable-MMS-features"><span>Enable MMS features</span></a></li><li><a class="tocitem" href="#Enable-NetCDF-output"><span>Enable NetCDF output</span></a></li><li><a class="tocitem" href="#Set-up-Plots-based-plotting-routines"><span>Set up <code>Plots</code>-based plotting routines</span></a></li></ul></li><li><a class="tocitem" href="../moment_kinetic_equations/">Moment kinetic equations</a></li><li><a class="tocitem" href="../parameter_scans/">Parameter scans</a></li><li><a class="tocitem" href="../post_processing_notes/">Post processing</a></li><li><a class="tocitem" href="../shared_memory_debugging/">Shared memory debugging</a></li><li><a class="tocitem" href="../wall_boundary_conditions/">Wall boundary conditions with moment constraints</a></li><li><a class="tocitem" href="../zz_advection/"><code>advection</code></a></li><li><a class="tocitem" href="../zz_analysis/"><code>analysis</code></a></li><li><a class="tocitem" href="../zz_array_allocation/"><code>array_allocation</code></a></li><li><a class="tocitem" href="../zz_bgk/"><code>bgk</code></a></li><li><a class="tocitem" href="../zz_calculus/"><code>calculus</code></a></li><li><a class="tocitem" href="../zz_charge_exchange/"><code>charge_exchange</code></a></li><li><a class="tocitem" href="../zz_chebyshev/"><code>chebyshev</code></a></li><li><a class="tocitem" href="../zz_clenshaw_curtis/"><code>clenshaw_curtis</code></a></li><li><a class="tocitem" href="../zz_command_line_options/"><code>command_line_options</code></a></li><li><a class="tocitem" href="../zz_communication/"><code>communication</code></a></li><li><a class="tocitem" href="../zz_constants/"><code>constants</code></a></li><li><a class="tocitem" href="../zz_continuity/"><code>continuity</code></a></li><li><a class="tocitem" href="../zz_coordinates/"><code>coordinates</code></a></li><li><a class="tocitem" href="../zz_debugging/"><code>debugging</code></a></li><li><a class="tocitem" href="../zz_derivatives/"><code>derivatives</code></a></li><li><a class="tocitem" href="../zz_em_fields/"><code>em_fields</code></a></li><li><a class="tocitem" href="../zz_energy_equation/"><code>energy_equation</code></a></li><li><a class="tocitem" href="../zz_external_sources/"><code>external_sources</code></a></li><li><a class="tocitem" href="../zz_file_io/"><code>file_io</code></a></li><li><a class="tocitem" href="../zz_finite_differences/"><code>finite_differences</code></a></li><li><a class="tocitem" href="../zz_fokker_planck/"><code>fokker_planck</code></a></li><li><a class="tocitem" href="../zz_fokker_planck_calculus/"><code>fokker_planck_calculus</code></a></li><li><a class="tocitem" href="../zz_fokker_planck_test/"><code>fokker_planck_test</code></a></li><li><a class="tocitem" href="../zz_force_balance/"><code>force_balance</code></a></li><li><a class="tocitem" href="../zz_gauss_legendre/"><code>gauss_legendre</code></a></li><li><a class="tocitem" href="../zz_geo/"><code>geo</code></a></li><li><a class="tocitem" href="../zz_initial_conditions/"><code>initial_conditions</code></a></li><li><a class="tocitem" href="../zz_input_structs/"><code>input_structs</code></a></li><li><a class="tocitem" href="../zz_interpolation/"><code>interpolation</code></a></li><li><a class="tocitem" href="../zz_ionization/"><code>ionization</code></a></li><li><a class="tocitem" href="../zz_krook_collisions/"><code>krook_collisions</code></a></li><li><a class="tocitem" href="../zz_load_data/"><code>load_data</code></a></li><li><a class="tocitem" href="../zz_looping/"><code>looping</code></a></li><li><a class="tocitem" href="../zz_makie_post_processing/"><code>makie_post_processing</code></a></li><li><a class="tocitem" href="../zz_manufactured_solns/"><code>manufactured_solns</code></a></li><li><a class="tocitem" href="../zz_moment_constraints/"><code>moment_constraints</code></a></li><li><a class="tocitem" href="../zz_moment_kinetics/"><code>moment_kinetics</code></a></li><li><a class="tocitem" href="../zz_moment_kinetics_input/"><code>moment_kinetics_input</code></a></li><li><a class="tocitem" href="../zz_moment_kinetics_structs/"><code>moment_kinetics_structs</code></a></li><li><a class="tocitem" href="../zz_neutral_r_advection/"><code>neutral_r_advection</code></a></li><li><a class="tocitem" href="../zz_neutral_vz_advection/"><code>neutral_vz_advection</code></a></li><li><a class="tocitem" href="../zz_neutral_z_advection/"><code>neutral_z_advection</code></a></li><li><a class="tocitem" href="../zz_numerical_dissipation/"><code>numerical_dissipation</code></a></li><li><a class="tocitem" href="../zz_plot_MMS_sequence/"><code>plot_MMS_sequence</code></a></li><li><a class="tocitem" href="../zz_plot_sequence/"><code>plot_sequence</code></a></li><li><a class="tocitem" href="../zz_plots_post_processing/"><code>plots_post_processing</code></a></li><li><a class="tocitem" href="../zz_quadrature/"><code>quadrature</code></a></li><li><a class="tocitem" href="../zz_r_advection/"><code>r_advection</code></a></li><li><a class="tocitem" href="../zz_reference_parameters/"><code>reference_parameters</code></a></li><li><a class="tocitem" href="../zz_source_terms/"><code>source_terms</code></a></li><li><a class="tocitem" href="../zz_time_advance/"><code>time_advance</code></a></li><li><a class="tocitem" href="../zz_type_definitions/"><code>type_definitions</code></a></li><li><a class="tocitem" href="../zz_utils/"><code>utils</code></a></li><li><a class="tocitem" href="../zz_velocity_grid_transforms/"><code>velocity_grid_transforms</code></a></li><li><a class="tocitem" href="../zz_velocity_moments/"><code>velocity_moments</code></a></li><li><a class="tocitem" href="../zz_vpa_advection/"><code>vpa_advection</code></a></li><li><a class="tocitem" href="../zz_z_advection/"><code>z_advection</code></a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Manual setup</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Manual setup</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mabarnes/moment_kinetics/blob/master/docs/src/manual_setup.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Manual-setup"><a class="docs-heading-anchor" href="#Manual-setup">Manual setup</a><a id="Manual-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Manual-setup" title="Permalink"></a></h1><p>If you want or need to set up <code>moment_kinetics</code> without using <code>machines/machine_setup.sh</code>, you will need to follow at least the steps in the following sections.</p><h2 id="Install-Julia"><a class="docs-heading-anchor" href="#Install-Julia">Install Julia</a><a id="Install-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#Install-Julia" title="Permalink"></a></h2><p>Download Julia from <a href="https://julialang.org/downloads/">https://julialang.org/downloads/</a>, and add it to your <code>$PATH</code> so you can execute it from the command line.</p><h2 id="Add-moment_kinetics-packages"><a class="docs-heading-anchor" href="#Add-moment_kinetics-packages">Add <code>moment_kinetics</code> packages</a><a id="Add-moment_kinetics-packages-1"></a><a class="docs-heading-anchor-permalink" href="#Add-moment_kinetics-packages" title="Permalink"></a></h2><p>Create a &#39;project&#39; in the top-level directory by creating an empty <code>Project.toml</code> file, e.g.</p><pre><code class="nohighlight hljs">$ touch Project.toml</code></pre><p>Without this <code>Project.toml</code> file, running <code>julia --project</code> will activate a global project, not one linked specificially to the repo you are in, which is likely to cause confusion if you have more than one copy of the <code>moment_kinetics</code> repo (experience suggests you are likely to end up with multiple copies eventually!).</p><p>To add the <code>moment_kinetics</code> package to your project, start Julia, enter &#39;Package mode&#39; by pressing &#39;]&#39; at the prompt and use <code>develop</code> (to exit &#39;Package mode&#39; and return to the usual <code>julia&gt;</code> prompt, press backspace):</p><pre><code class="language-julia hljs">$ julia --project
julia&gt; ]
pkg&gt; develop ./moment_kinetics/</code></pre><p>To allow post-processing add one or both of the post processing packages</p><pre><code class="language-julia hljs">pkg&gt; develop ./makie_post_processing/makie_post_processing/</code></pre><p>and/or</p><pre><code class="language-julia hljs">pkg&gt; develop ./plots_post_processing/plots_post_processing/</code></pre><p>To use the <code>run_moment_kinetics.jl</code> script, you will need to install <code>MPI</code> into the top-level project</p><pre><code class="language-julia hljs">pkg&gt; add MPI</code></pre><h2 id="Set-up-MPI"><a class="docs-heading-anchor" href="#Set-up-MPI">Set up MPI</a><a id="Set-up-MPI-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-MPI" title="Permalink"></a></h2><p>You probably want to use your system&#39;s MPI rather than a Julia-provided version. To do this add (in &#39;Package mode&#39;) the <code>MPIPreferences</code> package (<a href="https://juliaparallel.org/MPI.jl/stable/configuration/#using_system_mpi">documentation here</a>) and then use its <code>use_system_binary()</code> function.</p><pre><code class="language-julia hljs">pkg&gt; add MPIPreferences
pkg&gt; &lt;press &#39;backspace&#39;&gt;
julia&gt; using MPIPreferences
julia&gt; MPIPreferences.use_system_binary()</code></pre><p>Normally this should &#39;just work&#39;. Sometimes, for example if the MPI library file is named something other than <code>libmpi.so</code>, you might have to pass some keyword arguments to <code>use_system_binary()</code> - see <a href="https://juliaparallel.org/MPI.jl/stable/reference/mpipreferences/#MPIPreferences.use_system_binary">https://juliaparallel.org/MPI.jl/stable/reference/mpipreferences/#MPIPreferences.use_system_binary</a>.</p><h2 id="Link-HDF5"><a class="docs-heading-anchor" href="#Link-HDF5">Link HDF5</a><a id="Link-HDF5-1"></a><a class="docs-heading-anchor-permalink" href="#Link-HDF5" title="Permalink"></a></h2><p>To enable parallel I/O, you need to get HDF5.jl to use the system HDF5 library (which must be MPI-enabled and compiled using the same MPI as you run Julia with). To do this (see <a href="https://juliaio.github.io/HDF5.jl/stable/#Using-custom-or-system-provided-HDF5-binaries">the HDF5.jl docs</a>) add the <code>HDF5</code> package and use its <code>HDF5.API.set_libraries!()</code> function</p><pre><code class="language-julia hljs">pkg&gt; add HDF5
pkg&gt; &lt;press backspace&gt;
julia&gt; using HDF5
julia&gt; HDF5.API.set_libraries!(&quot;/path/to/your/hdf5/directory/libhdf5.so&quot;, &quot;/path/to/your/hdf5/directory/libhdf5_hl.so&quot;)</code></pre><p>JTO also found that (on a Linux laptop) it was necessary to compile HDF5 from source. The system-provided, MPI-linked libhdf5 depended on libcurl, and Julia links to an incompatible libcurl, causing an error. When compiled from source (enabling MPI!), HDF5 does not require libcurl (guess it is an optional dependency), avoiding the problem.</p><h2 id="Enable-MMS-features"><a class="docs-heading-anchor" href="#Enable-MMS-features">Enable MMS features</a><a id="Enable-MMS-features-1"></a><a class="docs-heading-anchor-permalink" href="#Enable-MMS-features" title="Permalink"></a></h2><p>To enable the &quot;method of manufactured solutions&quot; (MMS) features, install the <code>Symbolics</code> package (for more explanation, see <a href="../developing/#Optional-dependencies">Optional dependencies</a>)</p><pre><code class="language-julia hljs">pkg&gt; add Symbolics</code></pre><h2 id="Enable-NetCDF-output"><a class="docs-heading-anchor" href="#Enable-NetCDF-output">Enable NetCDF output</a><a id="Enable-NetCDF-output-1"></a><a class="docs-heading-anchor-permalink" href="#Enable-NetCDF-output" title="Permalink"></a></h2><p>If you want the option to output to NetCDF instead of HDF5, install the <code>NCDatasets</code> package (for more explanation, see <a href="../developing/#Optional-dependencies">Optional dependencies</a>)</p><pre><code class="language-julia hljs">pkg&gt; add NCDatasets</code></pre><h2 id="Set-up-Plots-based-plotting-routines"><a class="docs-heading-anchor" href="#Set-up-Plots-based-plotting-routines">Set up <code>Plots</code>-based plotting routines</a><a id="Set-up-Plots-based-plotting-routines-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-Plots-based-plotting-routines" title="Permalink"></a></h2><p>The <code>plots_post_processing</code> package has some functions that have to use <code>PyPlot</code> directly to access features not available through the <code>Plots</code> wrapper. This means that Julia has to be able to access an instance of Python which has <code>matplotlib</code> available. If you are going to use <code>plots_post_processing</code> you may well want to use the same Python that you use outside Julia (e.g. a system-provided Python) - to do so:</p><ul><li>Check that <code>matplotlib</code> is installed, e.g. check that<pre><code class="language-python hljs">$ python
&gt;&gt;&gt; import matplotlib</code></pre>completes without an error. If not, install matplotlib, for example with a command like<pre><code class="language-shell hljs">pip install --user matplotlib</code></pre></li><li>Set up Julia to use your chosen Python<pre><code class="language-julia hljs">$ which python
/your/python/location
$ julia -O3 --project
julia&gt; ENV[&quot;PYTHON&quot;]=&quot;/your/python/location&quot;
julia&gt; using Pkg; Pkg.build(&quot;PyCall&quot;)</code></pre></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../machine_setup_notes/">« <code>machine_setup</code> notes</a><a class="docs-footer-nextpage" href="../moment_kinetic_equations/">Moment kinetic equations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 28 March 2024 11:00">Thursday 28 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
