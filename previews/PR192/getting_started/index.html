<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting started · moment_kinetics</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">moment_kinetics</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../constraints_on_normalized_distribution_function/">Constraints on normalized distribution function</a></li><li><a class="tocitem" href="../debugging-hints/">Debugging</a></li><li><a class="tocitem" href="../developing/">Developing</a></li><li><a class="tocitem" href="../external_sources_notes/">External sources</a></li><li><a class="tocitem" href="../geometry/">Magnetic Geometry</a></li><li class="is-active"><a class="tocitem" href>Getting started</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Run-a-simulation"><span>Run a simulation</span></a></li><li><a class="tocitem" href="#Restarting"><span>Restarting</span></a></li><li><a class="tocitem" href="#Post-processing-with-makie_post_processing"><span>Post-processing with <code>makie_post_processing</code></span></a></li><li><a class="tocitem" href="#Parallel-I/O"><span>Parallel I/O</span></a></li><li><a class="tocitem" href="#Running-parameter-scans"><span>Running parameter scans</span></a></li><li><a class="tocitem" href="#Tests"><span>Tests</span></a></li></ul></li><li><a class="tocitem" href="../input_options/">Input Options</a></li><li><a class="tocitem" href="../machine_setup_notes/"><code>machine_setup</code> notes</a></li><li><a class="tocitem" href="../manual_setup/">Manual setup</a></li><li><a class="tocitem" href="../moment_kinetic_equations/">Moment kinetic equations</a></li><li><a class="tocitem" href="../parameter_scans/">Parameter scans</a></li><li><a class="tocitem" href="../post_processing_notes/">Post processing</a></li><li><a class="tocitem" href="../shared_memory_debugging/">Shared memory debugging</a></li><li><a class="tocitem" href="../wall_boundary_conditions/">Wall boundary conditions with moment constraints</a></li><li><a class="tocitem" href="../zz_advection/"><code>advection</code></a></li><li><a class="tocitem" href="../zz_analysis/"><code>analysis</code></a></li><li><a class="tocitem" href="../zz_array_allocation/"><code>array_allocation</code></a></li><li><a class="tocitem" href="../zz_bgk/"><code>bgk</code></a></li><li><a class="tocitem" href="../zz_calculus/"><code>calculus</code></a></li><li><a class="tocitem" href="../zz_charge_exchange/"><code>charge_exchange</code></a></li><li><a class="tocitem" href="../zz_chebyshev/"><code>chebyshev</code></a></li><li><a class="tocitem" href="../zz_clenshaw_curtis/"><code>clenshaw_curtis</code></a></li><li><a class="tocitem" href="../zz_command_line_options/"><code>command_line_options</code></a></li><li><a class="tocitem" href="../zz_communication/"><code>communication</code></a></li><li><a class="tocitem" href="../zz_constants/"><code>constants</code></a></li><li><a class="tocitem" href="../zz_continuity/"><code>continuity</code></a></li><li><a class="tocitem" href="../zz_coordinates/"><code>coordinates</code></a></li><li><a class="tocitem" href="../zz_debugging/"><code>debugging</code></a></li><li><a class="tocitem" href="../zz_derivatives/"><code>derivatives</code></a></li><li><a class="tocitem" href="../zz_em_fields/"><code>em_fields</code></a></li><li><a class="tocitem" href="../zz_energy_equation/"><code>energy_equation</code></a></li><li><a class="tocitem" href="../zz_external_sources/"><code>external_sources</code></a></li><li><a class="tocitem" href="../zz_file_io/"><code>file_io</code></a></li><li><a class="tocitem" href="../zz_finite_differences/"><code>finite_differences</code></a></li><li><a class="tocitem" href="../zz_fokker_planck/"><code>fokker_planck</code></a></li><li><a class="tocitem" href="../zz_fokker_planck_calculus/"><code>fokker_planck_calculus</code></a></li><li><a class="tocitem" href="../zz_fokker_planck_test/"><code>fokker_planck_test</code></a></li><li><a class="tocitem" href="../zz_force_balance/"><code>force_balance</code></a></li><li><a class="tocitem" href="../zz_gauss_legendre/"><code>gauss_legendre</code></a></li><li><a class="tocitem" href="../zz_geo/"><code>geo</code></a></li><li><a class="tocitem" href="../zz_initial_conditions/"><code>initial_conditions</code></a></li><li><a class="tocitem" href="../zz_input_structs/"><code>input_structs</code></a></li><li><a class="tocitem" href="../zz_interpolation/"><code>interpolation</code></a></li><li><a class="tocitem" href="../zz_ionization/"><code>ionization</code></a></li><li><a class="tocitem" href="../zz_krook_collisions/"><code>krook_collisions</code></a></li><li><a class="tocitem" href="../zz_load_data/"><code>load_data</code></a></li><li><a class="tocitem" href="../zz_looping/"><code>looping</code></a></li><li><a class="tocitem" href="../zz_makie_post_processing/"><code>makie_post_processing</code></a></li><li><a class="tocitem" href="../zz_manufactured_solns/"><code>manufactured_solns</code></a></li><li><a class="tocitem" href="../zz_moment_constraints/"><code>moment_constraints</code></a></li><li><a class="tocitem" href="../zz_moment_kinetics/"><code>moment_kinetics</code></a></li><li><a class="tocitem" href="../zz_moment_kinetics_input/"><code>moment_kinetics_input</code></a></li><li><a class="tocitem" href="../zz_moment_kinetics_structs/"><code>moment_kinetics_structs</code></a></li><li><a class="tocitem" href="../zz_neutral_r_advection/"><code>neutral_r_advection</code></a></li><li><a class="tocitem" href="../zz_neutral_vz_advection/"><code>neutral_vz_advection</code></a></li><li><a class="tocitem" href="../zz_neutral_z_advection/"><code>neutral_z_advection</code></a></li><li><a class="tocitem" href="../zz_numerical_dissipation/"><code>numerical_dissipation</code></a></li><li><a class="tocitem" href="../zz_plot_MMS_sequence/"><code>plot_MMS_sequence</code></a></li><li><a class="tocitem" href="../zz_plot_sequence/"><code>plot_sequence</code></a></li><li><a class="tocitem" href="../zz_plots_post_processing/"><code>plots_post_processing</code></a></li><li><a class="tocitem" href="../zz_quadrature/"><code>quadrature</code></a></li><li><a class="tocitem" href="../zz_r_advection/"><code>r_advection</code></a></li><li><a class="tocitem" href="../zz_reference_parameters/"><code>reference_parameters</code></a></li><li><a class="tocitem" href="../zz_source_terms/"><code>source_terms</code></a></li><li><a class="tocitem" href="../zz_time_advance/"><code>time_advance</code></a></li><li><a class="tocitem" href="../zz_type_definitions/"><code>type_definitions</code></a></li><li><a class="tocitem" href="../zz_utils/"><code>utils</code></a></li><li><a class="tocitem" href="../zz_velocity_grid_transforms/"><code>velocity_grid_transforms</code></a></li><li><a class="tocitem" href="../zz_velocity_moments/"><code>velocity_moments</code></a></li><li><a class="tocitem" href="../zz_vpa_advection/"><code>vpa_advection</code></a></li><li><a class="tocitem" href="../zz_z_advection/"><code>z_advection</code></a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting started</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mabarnes/moment_kinetics/blob/master/README.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h1><p>The full documentation is online at <a href="https://mabarnes.github.io/moment_kinetics">https://mabarnes.github.io/moment_kinetics</a>.</p><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>First clone this git repository, e.g. (to clone it into a directory with the default name <code>moment_kinetics</code>)</p><pre><code class="language-bash hljs">$ git clone git@github.com:mabarnes/moment_kinetics</code></pre><p>The command above assumes that you have an account on Github.com, and that account has ssh keys set up. If that is not the case you can clone using https instead</p><pre><code class="language-bash hljs">$ git clone https://github.com/mabarnes/moment_kinetics</code></pre><p>When using https some things (e.g. pushing to the remote repository) may require you to use 2-factor authentication, see https://docs.github.com/en/get-started/getting-started-with-git/about-remote-repositories#cloning-with-https-urls.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Do not download the zip-file from the Github.com page. This gives you the source code files but does not create a git repository. We get some version information from git when running the code, so without the git repository you will not be able to run a simulation.</p></div></div><ol><li><p>If you have already installed Julia, ensure that the Julia version is &gt;=  1.9.0 by doing  <code>$ julia --version</code>  at command line. The setup script in step 2 can also download a Julia  binary if you have not already installed Julia.</p></li><li><p>If you are running on a desktop/laptop (rather than an HPC cluster) ensure  that you have an MPI implementation installed (using whatever the usual way  of installing software is on your system). It should not matter which MPI  implementation - <code>openmpi</code> is often a good choice if you have no reason to  prefer a particular one. Check that the MPI compiler wrapper <code>mpicc</code> is  available, e.g.  <code>$ mpicc --version</code>  should run without an error.</p></li><li><p>Run the setup script  <code>$ machines/machine_setup.sh</code>  This script will prompt you for various options. The default choices should  be sensible in most cases. On a laptop/desktop the &#39;name of machine to set  up&#39; will be &#39;generic-pc&#39; and will set up for interactive use. On supported  clusters, &#39;name of machine&#39; will be the name of the cluster. On other  clusters &#39;generic-batch&#39; can be used, but requires some manual setup (see  <code>machines/generic-batch-template/README.md</code>).</p><p>For more information, see  <a href="https://mabarnes.github.io/moment_kinetics/dev/machine_setup_notes/"><code>machine_setup</code> notes</a>.</p><p>If you want or need to set up &#39;by hand&#39; without using  <code>machines/machine_setup.sh</code>, see  <a href="https://mabarnes.github.io/moment_kinetics/dev/manual_setup/">Manual setup</a>.</p></li></ol><p>Some other notes that might sometimes be useful:</p><ul><li><p>To speed up running scripts or the first call of <code>run_moment_kinetics</code> in a   REPL session, it is possible to compile a &#39;system image&#39;   (<code>moment_kinetics.so</code>). By running   <code>$ julia --project -O3 precompile.jl</code>   and then start Julia by running for example   <code>$ julia --project -O3 -Jmoment_kinetics.so</code>   this significantly decreases the load time but prevents code changes from   taking effect when <code>moment_kinetics.so</code> is used until you repeat the   compilation of the system image. Note that this also prevents the <code>Revise</code>   package from updating <code>moment_kinetics</code> when you edit the code during and   interactive session.</p><p>System images are created by default on HPC clusters, and are required to   use the provided <code>jobscript-*.template</code> submission scripts (used by   <code>submit-run.sh</code> and <code>submit-restart.sh</code>). This is to try and minimise the   compilation that has to be replicated on all the (possibly thousands of)   processes in a parallel run. After changing source code, you should run   <code>$ precompile-submit.sh</code>   (to re-compile the <code>moment_kinetics.so</code> system image).</p></li><li><p>In the course of development, it is sometimes helpful to upgrade the Julia   version. Upgrading the version of Julia or upgrading packages may require a   fresh installation of <code>moment_kinetics</code>. To make a fresh install with the   latest package versions you should be able to just run   <code>julia   pkg&gt; update</code>   (to enter &#39;Package mode&#39; enter &#39;]&#39; at the <code>julia&gt;</code> prompt). It might   sometimes necessary or helpful to instead remove (or rename) the   <code>Manifest.jl</code> file in the main directory, and re-run the setup from step 2)   above. It can sometimes be necessary to remove or rename the <code>.julia/</code>   directory (located by default in your home directory) to force all the   dependencies to be rebuilt.</p></li><li><p>When using the <code>Plots</code>-based post-processing library, one may have to set an   environment variable to avoid error messages from the Qt library. If you   execute the command   <code>$ julia --project run_post_processing.jl runs/your_run_dir/</code>   and see the error message   <code>qt.qpa.xcb: could not connect to display   qt.qpa.plugin: Could not load the Qt platform plugin &quot;xcb&quot; in &quot;&quot; even though it was found.   This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.</code>   this can be suppressed by setting   <code>export QT_QPA_PLATFORM=offscreen</code>   in your <code>.bashrc</code> or <code>.bash_profile</code> files.</p></li></ul><h2 id="Run-a-simulation"><a class="docs-heading-anchor" href="#Run-a-simulation">Run a simulation</a><a id="Run-a-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Run-a-simulation" title="Permalink"></a></h2><p>To run julia with optimization, type</p><pre><code class="nohighlight hljs">$ julia -O3 --project run_moment_kinetics.jl input.toml</code></pre><p>Note that the middle character in <code>-O3</code> is a capital letter &#39;O&#39;, not a zero. (On HPC clusters, or if you selected the &quot;set up separate packages for post processing&quot; option from <code>machines/machine_setup.sh</code>, you should use <code>-O3 --check-bounds=no</code> instead of just <code>-O3</code>, and the same in the <a href="https://mabarnes.github.io/moment_kinetics/dev/getting_started/#Restarting">Restarting</a> section.)</p><p>Options are specified in a TOML file, e.g. <code>input.toml</code> here. The defaults are specified in <code>moment_kinetics_input.jl</code>.</p><ul><li>To run in parallel, just put <code>mpirun -np &lt;n&gt;</code> in front of the call you would normally use, with <code>&lt;n&gt;</code> the number of processes to use.</li><li>It may be more convenient when running <code>moment_kinetics</code> more than once to work from the Julia REPL, e.g.   <code>$ julia -O3 --project   julia&gt; using moment_kinetics   julia&gt; run_moment_kinetics(&quot;input.toml&quot;)</code>   where <code>input</code> is the name of a TOML file containing the desired options. It   is also possible to pass a <code>Dict()</code> containing any non-default options   desired, which might sometimes be useful in tests or scripts   <code>julia&gt; run_moment_kinetics(input)</code>   Especially when developing the code, a lot of compilation time can be saved   by using <a href="https://timholy.github.io/Revise.jl/stable/">Revise.jl</a>, and   re-running a test case in the REPL (without restarting <code>julia</code>) - this is   enabled by default when setting up using <code>machines/machine_setup.sh</code> for   &#39;generic-pc&#39;.</li></ul><p>On an HPC cluster, you can submit a simulation (using the input file <code>input.toml</code>) to the batch queue using the convenience script</p><pre><code class="nohighlight hljs">$ ./submit-run.sh input.toml</code></pre><p>See the help text</p><pre><code class="nohighlight hljs">$ ./submit-run.sh -h</code></pre><p>for various command line options to change parameters (e.g. number of nodes, etc.).</p><p>If you need to rebuild the system images <code>moment_kinetics.so</code> and <code>makie_postproc.so</code> or <code>plots_postproc.so</code> because you have updated the code since they were built, it may be convenient to use</p><pre><code class="nohighlight hljs">$ ./submit-precompile-and-run.sh input.toml</code></pre><p>which will submit jobs for compilation, to run the simulation, and to do post processing. The simulation job will wait for the compilation job creating <code>moment_kinetics.so</code> to finish before starting. The post processing job will wait for the compilation job creating <code>makie_postproc.so</code> or <code>plots_postproc.so</code> to finish before starting.</p><h3 id="Stopping-a-run"><a class="docs-heading-anchor" href="#Stopping-a-run">Stopping a run</a><a id="Stopping-a-run-1"></a><a class="docs-heading-anchor-permalink" href="#Stopping-a-run" title="Permalink"></a></h3><p>When running in the REPL (especially with MPI) interrupting a run using Ctrl-C can mess things up, and require you to restart Julia. There is also a chance that you might interrupt while writing the output files and corrupt them. To avoid these problems, you can stop the run cleanly (including writing the distribution functions at the last time point, so that it is possible to restart the run from where you stopped it), by creating an empty file called <code>stop</code> in the run directory. For example, if the name of your run is &#39;my_example&#39;</p><pre><code class="language-shell hljs">$ touch runs/my_example/stop</code></pre><p><code>moment_kinetics</code> checks for this file when it is going to write output, and if it is present writes all output and then returns cleanly. The &#39;stop file&#39; is deleted when a run is (re-)started, if present, so you do not have to manually delete it before (re-)starting the run again.</p><h2 id="Restarting"><a class="docs-heading-anchor" href="#Restarting">Restarting</a><a id="Restarting-1"></a><a class="docs-heading-anchor-permalink" href="#Restarting" title="Permalink"></a></h2><p>To restart a simulation using <code>input.toml</code> from the last time point in the existing run directory,</p><pre><code class="nohighlight hljs">$ julia -O3 --project run_moment_kinetics --restart input.toml</code></pre><p>or to restart from a specific output file - either from the same run or (if the settings are compatible, see below) a different one - here <code>runs/example/example.dfns.h5</code></p><pre><code class="nohighlight hljs">$ julia -O3 --project run_moment_kinetics input.toml runs/example/example.dfns.h5</code></pre><p>The output file must include distribution functions. When not using parallel I/O there will be multiple output files from different MPI ranks - any one of these can be passed.</p><p>To do the same from the Julia REPL</p><pre><code class="nohighlight hljs">$ julia -O3 --project
julia&gt; run_moment_kinetics(&quot;input.toml&quot;, restart=true)</code></pre><p>or</p><pre><code class="nohighlight hljs">julia&gt; run_moment_kinetics(&quot;input.toml&quot;, restart=&quot;runs/example/example.dfns.h5&quot;)</code></pre><p>When calling the <code>run_moment_kinetics()</code> function you can also choose a particular time index to restart from, e.g.</p><pre><code class="nohighlight hljs">julia&gt; run_moment_kinetics(&quot;input.toml&quot;, restart=&quot;runs/example/example.dfns.h5&quot;, restart_time_index=42)</code></pre><p>On an HPC cluster, you can submit a restart (using the input file <code>input.toml</code>) to the batch queue using the convenience script</p><pre><code class="nohighlight hljs">$ ./submit-restart.sh input.toml</code></pre><p>or to restart from a particular output file</p><pre><code class="nohighlight hljs">$ ./submit-restart.sh -r runs/example/example.dfns.h5 input.toml</code></pre><p>See the help text</p><pre><code class="nohighlight hljs">$ ./submit-restart.sh -h</code></pre><p>for various other command line options to change parameters (e.g. number of nodes, etc.).</p><p>If you need to rebuild the system images <code>moment_kinetics.so</code> and <code>makie_postproc.so</code> or <code>plots_postproc.so</code> because you have updated the code since they were built, it may be convenient to use</p><pre><code class="nohighlight hljs">$ ./submit-precompile-and-restart.sh [-r runs/example/example.dfns.h5] input.toml</code></pre><p>which will submit jobs for compilation, to restart the simulation, and to do post processing. The simulation job will wait for the compilation job creating <code>moment_kinetics.so</code> to finish before starting. The post processing job will wait for the compilation job creating <code>makie_postproc.so</code> or <code>plots_postproc.so</code> to finish before starting.</p><p>It is possible to restart a run from another output file with different resolution settings or different moment-kinetic options. This is done by interpolating variables from the old run onto the new grid.</p><ul><li>When interpolating in spatial dimensions it is not recommended to change the length of the domain.</li><li>For velocity space dimensions, changing the size of the domain should be OK. Points outside the original domain will be filled with <span>$\propto \exp(-v^2)$</span> decreasing values.</li><li>When changing from 1D (no <span>$r$</span>-dimension) to 2D (with <span>$r$</span>-dimension), the interpolated values will be constant in <span>$r$</span>.</li><li>When changing from 1V to 2V or 3V, the interpolated values will be proportional to <span>$\exp(-v_j^2)$</span> in the new dimension(s).</li></ul><p>When running in parallel, both the old and the new grids must be compatible with the distributed-MPI parallelisation. When not using <a href="https://mabarnes.github.io/moment_kinetics/dev/getting_started/#Parallel-I/O">Parallel I/O</a>, the distributed-MPI domain decomposition must be identical in the old and new runs (as each block only reads from a single file).</p><h2 id="Post-processing-with-makie_post_processing"><a class="docs-heading-anchor" href="#Post-processing-with-makie_post_processing">Post-processing with <code>makie_post_processing</code></a><a id="Post-processing-with-makie_post_processing-1"></a><a class="docs-heading-anchor-permalink" href="#Post-processing-with-makie_post_processing" title="Permalink"></a></h2><p>The default post-processing module, written to be a bit more generic and flexible than the original Plots-based one, and able to be used interactively, is provided in <code>makie_post_processing</code>, see <a href="https://mabarnes.github.io/moment_kinetics/dev/post_processing_notes/">Post processing</a>.</p><p>On an HPC cluster, when you call <code>./submit-run.sh</code> or <code>./submit-restart.sh</code>, a job will (by default) be submitted to run <a href="https://mabarnes.github.io/moment_kinetics/dev/zz_makie_post_processing/#makie_post_processing.makie_post_process-Tuple"><code>makie_post_processing.makie_post_process</code></a> or <a href="https://mabarnes.github.io/moment_kinetics/dev/zz_plots_post_processing/#plots_post_processing.analyze_and_plot_data-Tuple"><code>plots_post_processing.analyze_and_plot_data</code></a> (depending on which you have set up, or on whether you pass the <code>-o</code> argument when both are set up) on the output after the run is finished. You can skip this by passing the <code>-a</code> argument to <code>./submit-run.sh</code> or <code>./submit-restart.sh</code>.</p><h3 id="Original,-Plots-based-post-processing-quickstart"><a class="docs-heading-anchor" href="#Original,-Plots-based-post-processing-quickstart">Original, Plots-based post processing quickstart</a><a id="Original,-Plots-based-post-processing-quickstart-1"></a><a class="docs-heading-anchor-permalink" href="#Original,-Plots-based-post-processing-quickstart" title="Permalink"></a></h3><p>This post-processing functionality is now disabled by default, but you can enable it by entering <code>y</code> at the &quot;Would you like to set up plots_post_processing?&quot; prompt in <code>machines/machine_setup.sh</code>.</p><p>To make plots and calculate frequencies/growth rates, run</p><pre><code class="nohighlight hljs">$ julia --project -O3 run_post_processing.jl runs/&lt;directory to process&gt;</code></pre><p>passing the directory to process as a command line argument. Input options for post-processing can be specified in <code>post_processing_input.jl</code>. Note that even when running interactively, it is necessary to restart Julia after modifying <code>post_processing_input.jl</code>.</p><p>Post processing can be done for several directories at once using</p><pre><code class="nohighlight hljs">$ julia --project -O3 post_processing_driver.jl runs/&lt;directory1&gt; runs/&lt;directory2&gt; ...</code></pre><p>passing the directories to process as command line arguments. Optionally pass a number as the first argument to parallelise post processing of different directories.</p><h2 id="Parallel-I/O"><a class="docs-heading-anchor" href="#Parallel-I/O">Parallel I/O</a><a id="Parallel-I/O-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-I/O" title="Permalink"></a></h2><p>To enable parallel I/O, HDF5.jl needs to be configured to use an HDF5 library which has MPI enabled and is compiled using the same MPI as you run Julia with. To ensure this happens, <code>machines/machine_setup.sh</code> will download the HDF5 source code and compile a local copy of the library under <code>machines/artifacts</code>, unless you enter <code>n</code> at the &quot;Do you want to download, and compile a local version of HDF5&quot; prompt (except on known HPC clusters where an MPI-enabled HDF5 is provided by a module - this is currently true on ARCHER2 - where the module-provided HDF5 is used).</p><h2 id="Running-parameter-scans"><a class="docs-heading-anchor" href="#Running-parameter-scans">Running parameter scans</a><a id="Running-parameter-scans-1"></a><a class="docs-heading-anchor-permalink" href="#Running-parameter-scans" title="Permalink"></a></h2><p>Parameter scans (see <a href="https://mabarnes.github.io/moment_kinetics/dev/parameter_scans/#Parameter-scans">Parameter scans</a>) can be performed by running</p><pre><code class="nohighlight hljs">$ julia -O3 --project run_parameter_scan.jl path/to/scan/input.toml</code></pre><p>If running a scan, it can be parallelised by passing the <code>-p</code> argument to julia, e.g. to run on 8 processes</p><pre><code class="nohighlight hljs">$ julia -p 8 -O3 --project run_parameter_scan.jl path/to/scan/input.toml</code></pre><h2 id="Tests"><a class="docs-heading-anchor" href="#Tests">Tests</a><a id="Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Tests" title="Permalink"></a></h2><p>There is a test suite in the <code>test/</code> subdirectory. It can be run in a few ways:</p><ul><li>Execute some or all of the tests as a script. For example in the terminal run   <code>$ julia -O3 --project moment_kinetcs/test/runtests.jl</code>   or in the REPL run   <code>julia&gt; include(&quot;moment_kinetcs/test/runtests.jl&quot;)</code>   Individual test files can also be used instead of <code>runtests.jl</code>, which runs all the tests.</li><li>You can also run the tests using <code>Pkg</code>. Either using <code>pkg&gt;</code> mode   <code>$ julia -O3 --project   julia&gt; &lt;press &#39;]&#39; to enter pkg mode&gt;   (moment_kinetics) pkg&gt; test moment_kinetics</code>   using <code>Pkg</code> in the REPL   <code>$ julia -O3 --project   julia&gt; import Pkg   julia&gt; Pkg.test(&quot;moment_kinetics&quot;)</code>   or run on the command line   <code>julia -O3 --project -e &quot;import Pkg; Pkg.test(&quot;moment_kinetics&quot;)`</code>   The downside of this method is that it will cause <code>NCDatasets</code> to be   installed if you did not install it already, which might sometimes cause   linking errors (related to the HDF5 library, see <a href="https://mabarnes.github.io/moment_kinetics/dev/developing/#Optional-dependencies">Optional   dependencies</a>).</li></ul><p>By default the test suite should run fairly quickly (in a few minutes). To do so, it skips many cases. To run more comprehensive tests, you can activate the <code>--long</code> option:</p><ul><li>In the REPL, run   <code>julia&gt; push!(ARGS, &quot;--long&quot;)</code>   before running the tests.</li><li>Running from the terminal, pass as a command line argument, e.g.   <code>$ julia -O3 --project --long moment_kinetics/test/runtests.jl</code></li><li>Using <code>test_args</code> argument   <code>julia&gt; Pkg.test(&quot;moment_kinetics&quot;; test_args=[&quot;--long&quot;])</code>   Note the semicolon is necessary.</li></ul><p>To get more output on what tests were successful, an option <code>--verbose</code> (or <code>-v</code>) can be passed in a similar way to <code>--long</code> (if any tests fail, the output is printed by default).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../geometry/">« Magnetic Geometry</a><a class="docs-footer-nextpage" href="../input_options/">Input Options »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 28 March 2024 11:00">Thursday 28 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
